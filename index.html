<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Gensyn Runner</title>
<style>
  :root {
    --bg:#000000;
    --panel:#2b1b12;
    --neon:#b87333;
    --muted:#3b2a20;
    --ui:#d4a76a;
    --font: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }

  html, body {
    height:100%;
    margin:0;
    background:var(--bg);
    font-family:var(--font);
    overflow:hidden;
    color:var(--ui);
  }

  .wrap {
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .stage {
    width:100%;
    height:100%;
    max-width:880px;
    position:relative;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  canvas {
    width:100%;
    height:100%;
    background:linear-gradient(180deg,#1a0e07 0%, #000 70%);
    border:2px solid rgba(184,115,51,0.1);
    border-radius:8px;
    box-shadow:0 8px 40px rgba(184,115,51,0.05), inset 0 1px 0 rgba(255,255,255,0.03);
    touch-action:none;
  }

  .overlay {
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:rgba(0,0,0,0.8);
    z-index:20;
    color:var(--ui);
    text-align:center;
    padding:20px;
  }

  .card {
    background:rgba(43,27,18,0.85);
    border:1px solid rgba(184,115,51,0.15);
    border-radius:8px;
    padding:20px;
    width:90%;
    max-width:520px;
  }

  h1 {margin:0 0 8px; letter-spacing:2px; font-size:20px;}
  p {margin:6px 0; color:rgba(212,167,106,0.9);}
  button {
    margin-top:12px;
    padding:10px 18px;
    background:var(--ui);
    border:none;
    border-radius:8px;
    color:#1a0e07;
    font-weight:700;
    cursor:pointer;
  }

  .hidden { display:none; }
  .hud, .score {
    position:absolute;
    top:10px;
    font-family:monospace;
    font-size:14px;
    color:var(--ui);
    z-index:30;
  }
  .hud { left:12px; }
  .score { right:12px; }

  .char-grid {
    display:flex;
    justify-content:center;
    gap:10px;
    flex-wrap:wrap;
    margin-top:12px;
  }

  .char-option {
    border:2px solid transparent;
    border-radius:8px;
    overflow:hidden;
    cursor:pointer;
    width:80px;
    height:80px;
    background:var(--muted);
    transition:0.2s;
  }

  .char-option:hover {
    transform:scale(1.05);
    border-color:rgba(212,167,106,0.4);
  }

  .char-option.selected {
    border-color:var(--ui);
    box-shadow:0 0 10px rgba(212,167,106,0.4);
  }

  .char-option img {
    width:100%;
    height:100%;
    object-fit:cover;
  }

  .footer {
    position:fixed;
    left:0;
    right:0;
    bottom:8px;
    text-align:center;
    color:rgba(212,167,106,0.85);
    font-size:12px;
    z-index:40;
    pointer-events:none;
  }
  .footer a {
    color:var(--ui);
    text-decoration:none;
    pointer-events:auto;
  }
  .footer a:hover { text-decoration:underline; }

  @media (max-width:600px){
    .card {padding:16px;}
    h1{font-size:18px;}
    button{padding:12px 20px;}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="stage" id="stage">
    <canvas id="canvas" width="960" height="360"></canvas>

    <!-- Character select overlay -->
    <div class="overlay" id="charSelectOverlay">
      <div class="card">
        <h1>CHOOSE YOUR CHARACTER</h1>
        <p>Select one avatar to begin your run.</p><br>
        <div class="char-grid">
          <div class="char-option" data-src="images/bee.png"><img src="images/bee.png" alt="Bee Character"></div>
          <div class="char-option" data-src="images/ben.png"><img src="images/ben.png" alt="Ben Character"></div>
          <div class="char-option" data-src="images/ant.png"><img src="images/ant.png" alt="Ant Character"></div>
        </div>
        <button id="confirmCharBtn" disabled>CONFIRM</button>
      </div>
    </div>

    <!-- Start overlay -->
    <div class="overlay hidden" id="startOverlay">
      <div class="card">
        <h1>GENSYN RUNNER</h1>
        <p>Tap or press <strong>Space / ↑</strong> to jump. Swipe down to duck.</p>
        <button id="startBtn">START</button>
      </div>
    </div>

    <!-- Game over overlay -->
    <div class="overlay hidden" id="gameOverOverlay">
      <div class="card">
        <h1>GAME OVER</h1>
        <p id="finalScore">Score: 0</p>
        <button id="restartBtn">RESTART</button>
      </div>
    </div>

    <div class="hud" id="hud">High: 0</div>
    <div class="score" id="score">Score: 0</div>
  </div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let DPR = Math.max(1, window.devicePixelRatio || 1);

function resizeCanvas(){
  const rect = canvas.getBoundingClientRect();
  canvas.width = rect.width * DPR;
  canvas.height = rect.height * DPR;
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

const G = {
  gravity: 0.6,
  initialSpeed: 4.0,
  maxSpeed: 12,
  speedIncreaseInterval: 700,
  speedIncreaseAmount: 0.2,
  speedIncreasePerFrame: 0.003,
  jumpVel: -13.5,
  groundHeight: 60,
  spawnCactusFreq: 90,
  spawnBirdFreq: 520
};

const state = {
  running:false,
  frame:0,
  speed:G.initialSpeed,
  score:0,
  high:parseInt(localStorage.getItem('symbiotic_high')||'0',10)||0,
  obstacles:[],
  birds:[],
  clouds:[]
};

const player = {
  x:80, y:canvas.height/DPR - G.groundHeight - 48,
  w:44, h:44,
  vy:0, grounded:true
};

function resetPlayerY(){
  const groundY = (canvas.height / DPR) - G.groundHeight;
  player.y = groundY - player.h;
  player.vy = 0;
  player.grounded = true;
}
resetPlayerY();

/* === CHARACTER SELECTION === */
const charSelectOverlay = document.getElementById('charSelectOverlay');
const startOverlay = document.getElementById('startOverlay');
const charOptions = document.querySelectorAll('.char-option');
const confirmCharBtn = document.getElementById('confirmCharBtn');
let selectedCharSrc = null; // always reset on refresh

function showCharSelect(){
  // Ensure the character selection overlay is visible on load
  charSelectOverlay.classList.remove('hidden');
  startOverlay.classList.add('hidden');
  gameOverOverlay.classList.add('hidden');
}

charOptions.forEach(opt=>{
  opt.addEventListener('click',()=>{
    charOptions.forEach(o=>o.classList.remove('selected'));
    opt.classList.add('selected');
    selectedCharSrc = opt.dataset.src;
    confirmCharBtn.disabled = !selectedCharSrc;
    if(selectedCharSrc){
      loadPlayerImage(selectedCharSrc);
    }
  });
});

confirmCharBtn.addEventListener('click',()=>{
  charSelectOverlay.classList.add('hidden');
  startOverlay.classList.remove('hidden');
  loadPlayerImage(selectedCharSrc);
});

/* === GAME === */
let playerImg = new Image();
let playerImgLoaded=false, playerImgBroken=false;
function loadPlayerImage(src){
  if(!src){playerImgLoaded=false;playerImgBroken=true;return;}
  playerImg = new Image();
  playerImg.onload=()=>{playerImgLoaded=true;playerImgBroken=false;};
  playerImg.onerror=()=>{playerImgLoaded=false;playerImgBroken=true;};
  playerImg.src=src;
}

const hud=document.getElementById('hud');
const scoreEl=document.getElementById('score');
const gameOverOverlay=document.getElementById('gameOverOverlay');
const restartBtn=document.getElementById('restartBtn');
const startBtn=document.getElementById('startBtn');
const finalScore=document.getElementById('finalScore');

function rand(min,max){return Math.random()*(max-min)+min;}
function rectsCollide(a,b){return a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y;}

function spawnCactus(){
  const h=24+Math.floor(Math.random()*36);
  const w=14+Math.floor(Math.random()*20);
  const groundY=(canvas.height/DPR)-G.groundHeight;
  state.obstacles.push({x:(canvas.width/DPR)+20,y:groundY-h,w,h});
}
function spawnBird(){
  const y=120+Math.random()*60;
  state.birds.push({x:(canvas.width/DPR)+20,y,w:34,h:22,flap:0});
}
function spawnCloud(){
  const y=20+Math.random()*60;
  state.clouds.push({x:(canvas.width/DPR)+20,y,w:40+Math.random()*40});
}

function roundRect(ctx,x,y,w,h,r){const radius=r||6;ctx.beginPath();ctx.moveTo(x+radius,y);ctx.arcTo(x+w,y,x+w,y+h,radius);ctx.arcTo(x+w,y+h,x,y+h,radius);ctx.arcTo(x,y+h,x,y,radius);ctx.arcTo(x,y,x+w,y,radius);ctx.closePath();}

function drawBackground(){
  const g=ctx.createLinearGradient(0,0,0,canvas.height/DPR);
  g.addColorStop(0,'#1a0e07');g.addColorStop(1,'#000');
  ctx.fillStyle=g;ctx.fillRect(0,0,canvas.width/DPR,canvas.height/DPR);
  ctx.fillStyle='rgba(255,255,255,0.04)';
  for(const c of state.clouds){ctx.beginPath();ctx.ellipse(c.x,c.y,c.w,12,0,0,Math.PI*2);ctx.fill();}
  ctx.fillStyle='#3b281b';
  ctx.fillRect(0,(canvas.height/DPR)-G.groundHeight,canvas.width/DPR,G.groundHeight);
}

function drawCacti(){
  ctx.save();ctx.fillStyle='#6b4423';
  for(const o of state.obstacles){roundRect(ctx,o.x,o.y,o.w,o.h,4);ctx.fill();}
  ctx.restore();
}

function drawBirds(){
  ctx.save();ctx.strokeStyle='rgba(212,167,106,0.9)';ctx.lineWidth=2;
  for(const b of state.birds){const wing=Math.sin(b.flap/6)*8;ctx.beginPath();ctx.moveTo(b.x,b.y);ctx.quadraticCurveTo(b.x+10,b.y-wing,b.x+28,b.y);ctx.stroke();b.flap++;}
  ctx.restore();
}

function drawPlayer(){
  if(playerImgLoaded&&!playerImgBroken){
    ctx.drawImage(playerImg,player.x,player.y,player.w,player.h);
  }else{
    ctx.save();
    ctx.fillStyle='rgba(212,167,106,0.95)';
    roundRect(ctx,player.x,player.y,player.w,player.h,6);
    ctx.fill();
    ctx.restore();
  }
}

function update(){
  if(!state.running)return;
  state.frame++;
  if(state.speed<G.maxSpeed){state.speed+=G.speedIncreasePerFrame;if(state.speed>G.maxSpeed)state.speed=G.maxSpeed;}
  if(state.frame%200===0)spawnCloud();
  for(let i=state.clouds.length-1;i>=0;i--){const c=state.clouds[i];c.x-=state.speed*0.35;if(c.x+c.w<-50)state.clouds.splice(i,1);}
  player.vy+=G.gravity;player.y+=player.vy;
  const groundY=(canvas.height/DPR)-G.groundHeight;
  if(player.y+player.h>=groundY){player.y=groundY-player.h;player.vy=0;player.grounded=true;}
  else player.grounded=false;
  if(state.frame%G.spawnCactusFreq===0)spawnCactus();
  if(state.frame%G.spawnBirdFreq===0)spawnBird();
  for(let i=state.obstacles.length-1;i>=0;i--){const o=state.obstacles[i];o.x-=state.speed;if(o.x+o.w<-50)state.obstacles.splice(i,1);if(rectsCollide(player,o))return gameOver();}
  for(let i=state.birds.length-1;i>=0;i--){const b=state.birds[i];b.x-=state.speed*1.15;if(b.x+b.w<-50)state.birds.splice(i,1);if(rectsCollide(player,b))return gameOver();}
  state.score+=0.15;scoreEl.textContent='Score: '+Math.floor(state.score);
}

function render(){drawBackground();drawCacti();drawBirds();drawPlayer();}
function loop(){if(!state.running)return;update();render();requestAnimationFrame(loop);}

function jump(){if(player.grounded){player.vy=G.jumpVel;player.grounded=false;}}
function startGame(){
  if(!selectedCharSrc)return; // must pick avatar
  state.running=true;state.frame=0;state.score=0;state.speed=G.initialSpeed;
  state.obstacles=[];state.birds=[];state.clouds=[];
  resetPlayerY();startOverlay.classList.add('hidden');
  requestAnimationFrame(loop);
}
function gameOver(){
  state.running=false;
  const sc=Math.floor(state.score);
  if(sc>state.high){state.high=sc;localStorage.setItem('symbiotic_high',String(state.high));}
  finalScore.textContent='Score: '+sc;
  gameOverOverlay.classList.remove('hidden');
}
function restart(){
  gameOverOverlay.classList.add('hidden');
  startGame();
}

document.addEventListener('keydown',e=>{
  if(e.code==='Space'||e.code==='ArrowUp'){e.preventDefault();if(!state.running){startGame();}else{jump();}}
  if(e.key&&e.key.toLowerCase()==='r'){restart();}
});
canvas.addEventListener('mousedown',()=>{if(!state.running){startGame();return;}jump();});
startBtn.addEventListener('click',startGame);
restartBtn.addEventListener('click',restart);
hud.textContent='High: '+state.high;
showCharSelect();
</script>
<div class="footer">
  <p>made with ❤️by <a href="https://x.com/kongclaves" target="_blank">KONGCLAVES</a></p>
</div>
</body>
</html>


